define(["require","util","model.dragAndDrop"],function(require){var util=require("util"),DnD=require("model.dragAndDrop");util.registerStylesheet("./stylesheets/ui.widget.treeList.css");var UITreeListWidget=function(list,options,clickTimeout){if(!list||!list instanceof Array)return console.error("TreeList was instantiated without a list array. This obviously won't work."),!1;var self=this,options=options||{},appendTo=options.appendTo||document.body,node=this.node=util.createElement({tag:"ol"});options.clickTimeout=clickTimeout,options.isRootNode&&util.addClass(node,"UITreeListWidget"),options.isFinalNode&&util.addClass(node,"finalNode"),typeof options.customClass=="string"&&util.addClass(node,options.customClass),util.forEach(list,function(itemObj,index){var item=document.createElement("li"),itemInner=util.htmlEntities(itemObj.trackname||itemObj.name||itemObj.title||"Item "+index);options.wrapItemsIn instanceof Array&&options.wrapItemsIn.length==2&&options.wrapItemsIn[0]&&options.wrapItemsIn[1]&&(itemInner=options.wrapItemsIn[0]+itemInner+options.wrapItemsIn[1]),item.innerHTML=itemInner,typeof itemObj.setAttributes=="object"&&(itemObj.setAttributes.hasOwnProperty("customClass")&&(util.addClass(item,itemObj.setAttributes.customClass),delete itemObj.setAttributes.customClass),util.setAttributes(item,itemObj.setAttributes)),typeof options.setAttributes=="object"&&util.setAttributes(item,options.setAttributes),typeof itemObj.id=="string"&&item.setAttribute("data-id",itemObj.id),itemObj.children instanceof Array&&(typeof itemObj.options!="object"&&(itemObj.options={}),itemObj.options.isExpanded&&util.addClass(item,"expanded"),itemObj.options.appendTo=item,new UITreeListWidget(itemObj.children,itemObj.options)),typeof options.dragStartMethod=="function"&&options.isRootNode&&DnD.draggable({node:item,dropZone:"collection_playlist",start:options.dragStartMethod}),node.appendChild(item)}),options.isRootListener&&util.doubleClick(node,function(target){if(target instanceof HTMLLIElement){var isPopulated=!!target.getAttribute("data-populated");util.hasClass(target.parentNode,"finalNode")?isPopulated=!0:util.toggleClass(target,"expanded"),typeof options.onclick=="function"&&options.onclick(target,isPopulated)}},function(target){typeof options.ondblclick=="function"&&options.ondblclick(target)},options.clickTimeout),options.isRootNode||appendTo.setAttribute("data-populated","yes"),appendTo.appendChild(node)};return UITreeListWidget})
define(["util","model.persistence"],function(util,Persistence){var Settings=function(done){var self=this,settings=this.settings={},persistence=new Persistence("vibeSettings"),self=this;(function(){settings=persistence.load()||{}})();var writeSettings=function(){persistence.save(settings)};this.set=function(key,value){settings[key]=value,writeSettings()},this.unset=function(key){settings[key]?(delete settings[key],writeSettings()):console.error("Unable to unset '"+key+"' as it does not exist.")},this.get=function(key){return settings[key]},this.clear=function(){persistence.clear()},this.dialogueDefinitions={connection:{title:"Connection",body:"Set the Vibe Server's details.",form:{name:"connection",inputs:[{name:"host",title:"Host",placeholder:self.get("host")||"localhost"},{name:"port",type:"number",title:"Port",placeholder:self.get("port")||6232}],callback:function(input,callback){var host=input.host.value||input.host.placeholder,port=input.port.value||input.port.placeholder;if(host!==input.host.placeholder||port!==input.port.placeholder)self.set("host",host),self.set("port",port),dialogue.close(),typeof callback=="function"?(callback(),this.MDD.form.inputs[0].placeholder=host,this.MDD.form.inputs[1].placeholder=port):location.reload()}}},userInterface:{title:"User Interface",body:"Configure the User Interface.",form:{name:"connection",inputs:[{name:"collectionRootType",title:"Order Collection By ",type:"select",options:["Genre","Artist","Album","Track"],placeholder:self.get("collectionRootType")||"Genre"}],callback:function(inputs){inputs.collectionRootType.value!==inputs.collectionRootType.placeholder&&(vibe.collection.populateWithType(inputs.collectionRootType.value),self.set("collectionRootType",inputs.collectionRootType.value),this.MDD.form.inputs[0].placeholder=inputs.collectionRootType.value)}}},advanced:{title:"Developer",body:"Advanced configuration options for developmental purposes.",form:{name:"connection",inputs:[{name:"debug",title:"Debugging",type:"checkbox",checked:self.get("debug")},{name:"Clear Settings",type:"button",callback:function(){localStorage.clear(),location.reload(!0)}}],callback:function(input){input.debug.checked&&(self.set("debug",!0),location.reload(!0))}}},about:{title:function(){var build=util.getMetaContent("vibe-build");return build?"About Vibe (Build "+build+" )":"About Vibe (Version "+util.getMetaContent("vibe-version")+")"}(),navTitle:"About Vibe",body:"<p><img src='./images/shared.icon_alt.png' alt style='float:left' />Vibe is a next-generation Web Application that will stream music from a Vibe Server and allow it to be played on the browser. Vibe aims to provide an intuitive and fast User Interface by using the latest Web Technologies available.</p><p>Although the major components of this program are done, it still requires serious polish and won't be fully ready for some time.</p>",alignment:"justify"}}};return Settings})
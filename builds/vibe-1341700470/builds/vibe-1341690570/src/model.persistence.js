define(["util"],function(util){var ModelPersistence=function(name){var support=this.support=util.browser.hasSupport.localStorage;this.name=name,typeof support=="object"&&!ModelPersistence.prototype.hasShownError&&(require(["ui.widget.modalDialogue"],function(modal){modal.createSingle({title:"Error: "+support.message,body:"<p>Vibe encountered the following error when attempting to use persistent storage: "+support.message+". Additional information: "+support.name+'</p><p>Please check your security settings regarding localStorage, and if you\'re using FireFox and have your cookie expiation policy set to "Ask every time", set it to "until they expire".</p><p>See this bug for more details: <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=748620">Bug</a></p>',alignment:"justify",errorDialogue:!0,buttons:{Close:function(){this.close()}}})}),ModelPersistence.prototype.hasShownSecurityError=!0)};return ModelPersistence.prototype.load=function(){var data=this.support===!0?localStorage[this.name]:!1;if(!data)return!1;try{data=JSON.parse(localStorage[this.name])}catch(ex){data=!1}finally{return data}},ModelPersistence.prototype.save=function(set){typeof set=="object"&&this.support===!0&&(localStorage[this.name]=JSON.stringify(set))},ModelPersistence.prototype.clear=function(){this.support===!0&&delete localStorage[this.name]},ModelPersistence.prototype.hasShownError=!1,ModelPersistence})
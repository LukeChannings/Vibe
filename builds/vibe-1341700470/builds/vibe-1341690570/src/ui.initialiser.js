define(["require","util","ui.collection","ui.playlist","model.playlist","ui.player","model.player","ui.settingsAssistant"],function(require){var util=require("util"),Collection=require("ui.collection"),Playlist=require("ui.playlist"),PlaylistModel=require("model.playlist"),Player=require("ui.player"),PlayerModel=require("model.player"),SettingsAssistant=require("ui.settingsAssistant"),collection,playlist,player,playlistModel,playerModel,vibe=document.getElementById("Vibe"),api=null,settings=null,settingsAssistant=null,self=this,stage={collection:function(callback){collection=new Collection({withApi:api,onerror:function(){},onitemselect:function(item){playlistModel.add(item.type,item.id)},ondatadrop:function(){},dragAndDropElement:playlist.node,withRootType:settings.get("collectionRootType")||"genre",onload:callback})},playlist:function(callback){playlist=new Playlist({withControlBarButtons:[{isIcon:!0,customClass:"undo",callback:function(){playlistModel.undo()}},{isIcon:!0,customClass:"redo",callback:function(){playlistModel.redo()}},{isIcon:!0,customClass:"clear",callback:function(){playlistModel.clear()}},{isIcon:!0,customClass:"settings",floatRight:!0,callback:function(){settingsAssistant.presentDialogue()}}],onplayitem:function(row){util.removeClass(row.node,"selected"),playlistModel.setIndex(playlistModel.indexOfTrackId(row.id),row.node),playerModel.addSound(row.id,!0)},onload:function(){playlistModel=new PlaylistModel({withUI:playlist,withApi:api,onload:callback})}})},player:function(callback){player=new Player({onload:function(){playerModel=new PlayerModel({withSettings:settings,withPlaylistModel:playlistModel,withUI:player,onload:callback})}})}};return util.isMobile?initialiser=function(){console.log("Is Mobile.")}:initialiser=function(callback){util.browser.hasSupport.svg&&util.addClass(document.body,"svg"),api=this.api,settings=this.settings,settingsAssistant=new SettingsAssistant({withSettings:settings}),stage.playlist(function(){stage.collection(function(){stage.player(function(){util.appendChildren(vibe,[player.node,collection.node,playlist.node]),callback&&callback()})})})},initialiser.alertInterfaceToDisconnection=function(){var elements=[player,collection,playlist];util.forEach(elements,function(element){typeof element.didDisconnectFromServer=="function"&&element.didDisconnectFromServer()})},initialiser.alertInterfaceToReconnection=function(){var elements=[player,collection,playlist];util.forEach(elements,function(element){typeof element.didReconnectToServer=="function"&&element.didReconnectToServer()})},initialiser})
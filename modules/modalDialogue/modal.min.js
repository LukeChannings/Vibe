define(["require"],function(a){function h(a,b,c){var d=this;this.util=c;if(e(a)){if(b)this.overlay=b;var f=this.dialogue=document.createElement("div");var g=a.customId?a.customId:"ModalDialogue";f.setAttribute("id",g);var h=["visible"];if(a.errorDialogue)h.push("error");if(a.alignment&&/^(center|right|justify)$/.test(a.alignment)){h.push(a.alignment)}var i=document.createElement("h1");i.innerHTML=a.title;f.appendChild(i);if(!(a.body instanceof Array)){a.body=[a.body]}for(var j=0;j<a.body.length;j++){if(a.body[j]instanceof HTMLElement){f.appendChild(a.body[j])}else if(typeof a.body[j]=="string"){if(!/\<.+\>.*\<.+\>/.test(a.body[j]))a.body[j]="<p>"+a.body[j]+"</p>";f.innerHTML+=a.body[j]}}if(a.form){h.push("form");var k=document.createElement("form");k.setAttribute("name",a.form.name);k.setAttribute("method","post");for(var j=0;j<a.form.inputs.length;j++){if(a.form.inputs[j].title){var l=document.createElement("label");l.innerHTML=a.form.inputs[j].title}if(a.form.inputs[j].type&&a.form.inputs[j].type=="select"){var m=document.createElement("select");for(var n=0;n<a.form.inputs[j].options.length;n++){var o=document.createElement("option");o.setAttribute("value",a.form.inputs[j].options[n]);o.innerHTML=a.form.inputs[j].options[n];m.appendChild(o)}if(a.form.inputs[j].placeholder){m.value=a.form.inputs[j].placeholder}}else{var m=document.createElement("input");if(a.form.inputs[j].name){m.setAttribute("name",a.form.inputs[j].name)}else{m.setAttribute("name"+"input"+(j+1))}if(a.form.inputs[j].type){m.setAttribute("type",a.form.inputs[j].type)}else{m.setAttribute("type","text")}if(a.form.inputs[j].placeholder){if("placeholder"in m){m.setAttribute("placeholder",a.form.inputs[j].placeholder)}else{m.value=a.form.inputs[j].placeholder;m.setAttribute("placeholder",a.form.inputs[j].placeholder);d.util.addListener(m,"focus",function(a){var b=a.target||a.srcElement;if(b.getAttribute("placeholder")==b.value){b.value=""}});d.util.addListener(m,"blur",function(a){var b=a.target||a.srcElement;if(b.value==""){b.value=b.getAttribute("placeholder")}})}}}if(l){l.appendChild(m);k.appendChild(l)}else k.appendChild(m)}f.appendChild(k)}if(a.buttons){var p=document.createElement("div");p.setAttribute("class","buttons");for(var j in a.buttons){var q=document.createElement("button");if(/close/i.test(j)&&!(typeof a.buttons[j]=="function")){q.innerHTML="Close";if(typeof a.buttons[j]=="function"){d.util.addListener(q,"click",function(){a.buttons[j].call(d)})}else{d.util.addListener(q,"click",function(){if(a.isWizardDialogue)d.dialogue=d.dialogue.parentNode;d.close()})}}else if(typeof a.buttons[j]=="object"){q.innerHTML=a.buttons[j].title||j;if(typeof a.buttons[j].callback=="function"){if(a.isWizardDialogue){var r=parseInt(a.customId.match(/\d/)[0]);if(j=="next"){d.util.addListener(q,"click",function(b){a.buttons.next.callback.call(a.buttons.next.callbackContext,b,r)})}if(j=="prev"){d.util.addListener(q,"click",function(b){a.buttons.prev.callback.call(a.buttons.prev.callbackContext,b,r)})}}else{d.util.addListener(q,"click",a.buttons[j].callback)}}}else if(typeof a.buttons[j]=="function"){q.innerHTML=j;d.util.addListener(q,"click",function(){a.buttons[j].call(d)})}else continue;p.appendChild(q)}if(p.children.length!=0){f.appendChild(p)}else p=null}if(a.class){if(a.class instanceof Array){h=a.class.concat(h)}else if(typeof a.class=="string"){h.push(a.class)}}f.setAttribute("class",h.join(" "));return f}else{throw{message:"The specified MDO is invalid.",name:"MDO_FAULT"}}return null}function g(a,b,c,d){d.removeNode(a);b.style.opacity=0;b.removeAttribute("class")}function f(a,b,c,d){if(b.children.length>=1){d.removeNode(b.children[0])}if(typeof c=="string"&&/(slideTop|slideBottom|fade)/.test(c)){var e=d.BrowserHasSupport.cssTransitions();if(e){b.style.opacity=0;b.style[e]="opacity 0.5s linear";if(/slide/.test(c)){a.style.marginTop=c=="slideTop"?"-100%":"100%";a.style[e]="margin-top 0.5s linear";b.setAttribute("class","visible");b.appendChild(a);setTimeout(function(){b.style.opacity=1;a.style.marginTop="10%"},1)}if(c=="fade"){a.style.opacity=0;a.style[e]="opacity 0.2s linear";b.setAttribute("class","visible");b.appendChild(a);setTimeout(function(){b.style.opacity=1;a.style.opacity=1},1)}}}else{b.appendChild(a);b.setAttribute("class","visible")}}function e(a){if(typeof a=="object"&&!(a instanceof Array)){if(!a.title||!a.body)return false;if(a.isWizardDialogue){if(!a.buttons)return false;else{if(!a.buttons.next&&!a.buttons.prev&&!a.buttons.close)return false}}return true}}function d(a){if(!document.getElementById("ModalDialogueOverlay")){this.overlay=document.createElement("div");this.overlay.setAttribute("id","ModalDialogueOverlay");document.body.appendChild(this.overlay)}else{this.overlay=document.getElementById("ModalDialogueOverlay")}this.util=a}var b=document.createElement("link");b.setAttribute("type","text/css");b.setAttribute("rel","stylesheet");b.setAttribute("href",a.toUrl("./modal.css"));document.head.appendChild(b);var c=document.createElement("link");c.setAttribute("media","screen and (max-device-width: 480px)");c.setAttribute("rel","stylesheet");c.setAttribute("type","text/css");c.setAttribute("href",a.toUrl("./modal.mobile.css"));document.head.appendChild(c);d.prototype.close=function(){this.overlay.removeChild(this.overlay.children[0]);this.overlay.removeAttribute("class")};h.prototype.close=function(){g(this.dialogue,this.overlay,null,this.util)};d.prototype.createDialogue=function(a){if(e(a)){var b=new h(a,this.overlay,this.util);f(b,this.overlay,a.animateIn||null,this.util)}else console.error("ModalDialogue::createDialogue - No MDO!");return this};d.prototype.createWizard=function(a,b){var c=this;if(this.overlay.children.length>=1){c.util.removeNode(this.overlay.children[0])}var d=[];var g=document.createElement("div");g.setAttribute("id","ModalDialogue");for(var i=0;i<a.length;i++){a[i].customId="WizardDialogue"+(i+1);a[i].isWizardDialogue=true;if(!e(a[i])){console.error("MDO "+(i+1)+" is invalid.");return}if(typeof a[i].buttons.next=="boolean"){a[i].buttons.next={title:"Next",callback:function(a,b){c.util.removeNode(g.children[0]);g.appendChild(d[b])},callbackContext:this}}if(typeof a[i].buttons.prev=="boolean"){a[i].buttons.prev={title:"Previous",callback:function(a,b){c.util.removeNode(g.children[0]);g.appendChild(d[b-2])},callbackContext:this}}var j=new h(a[i],this.overlay,this.util);d.push(j)}g.appendChild(d[0]);f(g,this.overlay,b||null,this.util)};d.prototype.createDialogueWithSidebar=function(a){var b=this;if(this.overlay.children.length>=1){b.util.removeNode(this.overlay.children[0])}if(a){var c=document.createElement("div");c.setAttribute("id","ModalDialogue");c.setAttribute("class","sidebar");var d=document.createElement("div");d.setAttribute("class","navigation");var g=document.createElement("ol");var i=document.createElement("div");i.setAttribute("class","views");var j=this.views=[];var k=this.currentViewIndex=0;c.appendChild(d);c.appendChild(i);if(a.title){var l=document.createElement("h1");l.innerHTML=a.title;d.appendChild(l)}if(a.views){function m(a){var c=a.target||a.srcElement;if(!(k==c.getAttribute("data-viewIndex"))){b.util.removeNode(j[k]);i.appendChild(j[parseInt(c.getAttribute("data-viewIndex"))]);g.children[k].removeAttribute("class");k=parseInt(c.getAttribute("data-viewIndex"));g.children[k].setAttribute("class","active")}}if(a.views.length==0){console.error("dialogueDefinition has no views. Cannot continue.");return false}for(var n=0;n<a.views.length;n++){if(e(a.views[n])){a.views[n].customId="ModalView"+(n+1);a.views[n].class="view";if(a.views[n].buttons){delete a.views[n].buttons}var o=h(a.views[n],this.overlay,this.util);o.setAttribute("data-viewIndex",n);j.push(o);var p=document.createElement("li");p.innerHTML=a.views[n].navTitle||a.views[n].title;p.setAttribute("data-viewIndex",n);b.util.addListener(p,"click",function(a){m.call(b,a)});if(n==0)p.setAttribute("class","active");g.appendChild(p)}else{console.error("Invalid view. Choked on DMO "+(n+1));return false}}i.appendChild(j[0])}if(a.buttons){var q=document.createElement("div");q.setAttribute("class","buttons");for(var n in a.buttons){var r=document.createElement("button");if(n=="close"&&typeof a.buttons[n]!=="function"){r.innerHTML="Close";b.util.addListener(r,"click",function(){b.close()})}else{r.innerHTML=n;if(typeof a.buttons[n]=="function"){b.util.addListener(r,"click",function(c){a.buttons[n].call(b,c)})}}q.appendChild(r)}i.appendChild(q)}this.overlay.appendChild(c);this.overlay.setAttribute("class","visible");d.appendChild(g);f(c,this.overlay,a.animateIn||null,this.util);return c}else return false};return d})
(function(){"undefined"==typeof Array.prototype.forEach&&(Array.prototype.forEach=function(a){if("function"==typeof a)for(var b=0;b<this.length;b++)a(this[b],b,this)});"undefined"==typeof Element.prototype.setAttributes&&(Element.prototype.setAttributes=function(a){var b=this;if(a instanceof Array)a.forEach(function(a){b.setAttribute(a[0],a[1])});else if(typeof a=="object")for(var c in a)b.setAttribute(c,a[c])});"undefined"==typeof Element.prototype.removeNode&&(Element.prototype.removeNode=function(){this.parentNode.removeChild(this)});
"undefined"==typeof Element.prototype.removeChildren&&(Element.prototype.removeChildren=function(){for(;this.firstChild;)this.removeChild(this.firstChild)});"undefined"==typeof Element.prototype.toggleClass&&(Element.prototype.toggleClass=function(a){this.className=RegExp(a).test(this.className)?this.className.replace(a,""):this.className.length==0?a:this.className+(" "+a)});"undefined"==typeof Element.prototype.appendChildren&&(Element.prototype.appendChildren=function(a){var b=this;a.forEach(function(a){a instanceof
Element&&b.appendChild(a)})});Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c=this.length>>>0,e=Number(b)||0,e=e<0?Math.ceil(e):Math.floor(e);for(e<0&&(e=e+c);e<c;e++)if(e in this&&this[e]===a)return e;return-1});Element.prototype.addClass||(Element.prototype.addClass=function(a){if(this.className.length==0)this.className=a;else if(!RegExp("(^| )"+a+"( |$)").test(this.className))this.className=this.className+(" "+a)});Element.prototype.removeClass||(Element.prototype.removeClass=
function(a){this.className=this.className.replace(RegExp(" ?"+a+" ?"),"");this.className.length==0&&this.removeAttribute("class")});Element.prototype.hasClass||(Element.prototype.hasClass=function(a){return RegExp("(^| )"+a+"($| )").test(this.className)});if(!window.console||!window.console.log||!window.console.warn||!window.console.error)if(window.console||(window.console={}),console.log||(window.console.log=function(){}),console.warn||(window.console.warn=function(){}),!console.error)window.console.error=
function(){};var d={addListener:function(){return document.addEventListener?function(a,b,c){a.addEventListener(b,c,false)}:function(a,b,c){a.attachEvent("on"+b,c)}}(),removeListener:function(){return document.removeEventListener?function(a,b,c){a.removeEventListener(b,c,false)}:function(a,b,c){a.detachEvent(b,c)}}(),registerStylesheet:function(a){if(!window.registeredStylesheets)window.registeredStylesheets=[];if(window.registeredStylesheets.indexOf(a)==-1){(document.head||document.getElementsByTagName("head")[0]).appendChild(function(){var b=
document.createElement("link");b.setAttributes({rel:"stylesheet",type:"text/css",href:a});return b}());window.registeredStylesheets.push(a)}},Browser:{isMobile:function(){return/(iPhone|Android|Mobile)/i.test(navigator.userAgent)},isIE:function(){return/MSIE/i.test(navigator.userAgent)},HasSupport:{dragAndDrop:function(){return"draggable"in document.createElement("div")},svg:function(){return document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")},cssTransitions:function(){for(var a=
["transition","WebkitTransition","MozTransition","OTransition","msTransition"],b=0;b<a.length;b++)if(a[b]in document.createElement("div").style)return a[b].replace("Transition","");return false},localStorage:function(){try{return window.localStorage?true:false}catch(a){return a}}}},htmlEntities:function(a){return a.replace(/&/g,"&#38;").replace(/</g,"&#60;").replace(/>/g,"&#62;").replace(/\u00a3/g,"&#163;")},doubleClick:function(a,b,c,e){this.addListener(a,"click",function(a){var d=a.target||a.srcElement;
if(typeof clickTimeout=="undefined")clickTimeout=setTimeout(function(){clickTimeout=void 0;typeof b=="function"&&b(d)},e||170);else{clearTimeout(clickTimeout);clickTimeout=void 0;c(d)}})},cacheImage:function(a){(new Image).src=a},formatTime:function(a){var a=Math.ceil(a),b=Math.ceil(a/60),a=a%60;(""+b).length==1&&(b="0"+b);(""+a).length==1&&(a="0"+a);return b+":"+a},createElement:function(a){var b=this;if(typeof a=="object"&&a.hasOwnProperty("tag")){var c=document.createElement(a.tag);if(typeof a.inner==
"string")c.innerHTML=a.inner;a.id&&c.setAttribute("id",a.id);a.customClass&&c.setAttribute("class",a.customClass);a.setAttributes&&c.setAttributes(a.setAttributes);a.children&&a.children instanceof Array&&a.children.forEach(function(a){a.appendTo=c;b.createElement(a)});a.appendTo&&a.appendTo instanceof Element&&a.appendTo.appendChild(c);return c}return false},error:function(a,b){var c=Error();c.message=a||"Unknown error.";c.type=b;return c},getMetaContent:function(a){for(var b=document.getElementsByTagName("meta"),
c=0;c<b.length;c++)if(b[c].getAttribute("name")==a)return b[c].getAttribute("content");return false}},g=function(a,b,c,e){b=b.match(/((slide(out|in))(top|bottom|left|right)|fade(in|out))/i);this.callback=e;if(b!==null){e=d.Browser.HasSupport.cssTransitions();this.directions={top:"0px, -1000px",bottom:"0px, 1000px",left:"-1000px, 0px",right:"1000px, 0px"};/slidein/i.test(b[2])?this.slideIn(a,e,b[4],c):/slideout/i.test(b[2])?this.slideOut(a,e,b[4],c):/fadein/i.test(b[0])?this.fadeIn(a,e,c):/fadeout/i.test(b[0])&&
this.fadeOut(a,e,c)}else throw d.error("Invalid animation option.","ANIMATE_ERR");};g.prototype.slideIn=function(a,b,c,e){document.body.style.overflow="hidden";var d=this;a.style[b+"Transform"]="translate("+this.directions[c.toLowerCase()]+")";a.style[b+"Transition"]="-"+b.toLowerCase()+"-transform "+(e||0.3)+"s linear";setTimeout(function(){a.style[b+"Transform"]=null;setTimeout(function(){typeof d.callback=="function"&&d.callback();a.style[b+"Transition"]=document.body.style.overflow=null},e*1E3||
300)},100)};g.prototype.slideOut=function(a,b,c,d){var k=this;document.body.style.overflow="hidden";a.style[b+"Transition"]="-"+b.toLowerCase()+"-transform "+(d||0.3)+"s linear";setTimeout(function(){a.style[b+"Transform"]="translate("+k.directions[c.toLowerCase()]+")";setTimeout(function(){typeof k.callback=="function"&&k.callback();a.style[b+"Transition"]=a.style[b+"Transform"]=null},d*1E3||300)},100)};g.prototype.fadeIn=function(a,b,c){var d=this;a.style.opacity=0;a.style[b+"Transition"]="opacity "+
(c||0.3)+"s linear";setTimeout(function(){a.style.opacity=1;a.style[b+"Transition"]=a.style.opacity=null;typeof d.callback=="function"&&d.callback()},100)};g.prototype.fadeOut=function(a,b,c){var d=this;a.style[b+"Transition"]="opacity "+(c||0.3)+"s linear";setTimeout(function(){a.style.opacity=0;setTimeout(function(){a.style[b+"Transition"]=null;a.style.opacity=null;typeof d.callback=="function"&&d.callback()},c*1E3||300)},100)};var r=function(a,b){if(a instanceof Element&&b){a.value=b;a.addClass("placeholder");
a.setAttribute("placeholder",b);d.addListener(a,"focus",function(a){a=a.target||a.srcElement;if(a.value==b){a.value="";a.removeClass("placeholder")}});d.addListener(a,"blur",function(a){a=a.target||a.srcElement;if(a.value==""){a.value=b;a.addClass("placeholder")}})}else throw d.error("Invalid Parameters.");};d.addListener(window,"load",function(){function a(a){if(typeof a=="object"&&!(a instanceof Array)){if(!a.title||!a.body)return false;if(a.isWizardDialogue)if(a.buttons){if(!a.buttons.next&&!a.buttons.prev&&
!a.buttons.close)return false}else return false;return a.form&&(!a.form.name||!a.form.inputs)?false:true}}var b=document.getElementById("ModalDialogueOverlay")?document.getElementById("ModalDialogueOverlay"):d.createElement({tag:"div",id:"ModalDialogueOverlay",appendTo:document.body}),c=null,e=d.Browser.HasSupport.cssTransitions(),k,m,l=function(b){this.MDD=b;if(a(b)){var c=this.dialogue=d.createElement({tag:"div",id:b.customId||"ModalDialogue",customClass:"visible"});b.errorDialogue==true&&c.addClass("error");
b.alignment&&/^(center|right|justify)$/.test(b.alignment)&&c.addClass(b.alignment);d.createElement({tag:"h1",inner:b.title,appendTo:c});this.createBody(b.body);b.form&&this.createForm(b.form);b.buttons&&this.createButtons(b.buttons,b);b.customClass&&c.addClass(b.customClass);return c}throw d.error("Invalid Modal Dialogue Definiion.","MDD_ERR");};l.prototype.createBody=function(a){var b=this;a instanceof Array||(a=[a]);a.forEach(function(a){if(typeof a=="object"&&a instanceof Element)b.dialogue.appendChild(item);
else if(typeof a=="string"){/\<.+\>.*\<.+\>/.test(a)||(a="<p>"+a+"</p>");b.dialogue.innerHTML=b.dialogue.innerHTML+a}})};l.prototype.createForm=function(a){var b=d.createElement({tag:"form",appendTo:this.dialogue,setAttributes:{name:a.name,method:"post"}}),c=[];a.inputs.forEach(function(f,e){if(f.title)var h=d.createElement({tag:"label",inner:f.title});if(f.type&&f.type=="select"){var j=document.createElement("select");f.options.forEach(function(a){d.createElement({tag:"option",inner:a,appendTo:j,
setAttributes:{value:a}})})}else j=d.createElement({tag:"input",setAttributes:{name:f.name||a.name+"-"+e,type:f.type||"text"}});f.placeholder&&("placeholder"in j?j.setAttribute("placeholder",f.placeholder):new r(j,f.placeholder));if(h){h.appendChild(j);b.appendChild(h)}else b.appendChild(j);c.push(j);a.callback&&d.addListener(j,"keyup",function(b){b.keyCode===13&&a.callback(c)})});if(typeof a.callback=="function"){this.MDD.buttons=this.MDD.buttons||{};this.MDD.buttons[a.buttonName||"Apply"]=function(){a.callback(c)}}this.dialogue.appendChild(b)};
var s=function(a,b,c){a=d.createElement({tag:"button",inner:a});d.addListener(a,"click",function(a,b){return function(c){a.call(b||n,c)}}(b,c));return a};l.prototype.createButtons=function(a,b){var b=b instanceof Element?b:d.createElement({tag:"div",customClass:"buttons",appendTo:this.dialogue}),c;for(c in a){var e,i;if(typeof a[c]=="function"){e=c;i=a[c]}else if(typeof a[c]=="object"){e=a[c].title||a[c].name;i=a[c].callback}else if(typeof a[c]=="boolean"&&/close/i.test(c)){e="Close";i=function(){n.close()}}var h=
s(e,i,typeof a[c].context=="object"?a[c].context:n);h&&b.appendChild(h)}};var n={createSingle:function(a){k=a.animate&&typeof a.animate.in!=="undefined"?a.animate.in:null;m=a.animate&&typeof a.animate.out!=="undefined"?a.animate.out:null;this.open(new l(a))},createWizard:function(a,d){var e=0;k=d&&typeof d.in!=="undefined"?d.in:null;m=d&&typeof d.out!=="undefined"?d.out:null;a.forEach(function(d,i){if(d.buttons)for(var h in d.buttons)/(prev|next)/i.test(h)&&typeof d.buttons[h]==="boolean"&&(d.buttons[h]=
{name:h=="prev"?"Previous":"Next",callback:function(d){return function(){c.removeNode(true);e=d=="prev"?e-1:e+1;c=a[e];b.appendChild(c)}}(h)});a[i]=new l(d)});this.open(a[0])},createMultiView:function(b){if(typeof b!=="object")return false;k=b.animate&&typeof b.animate.in!=="undefined"?b.animate.in:null;m=b.animate&&typeof b.animate.out!=="undefined"?b.animate.out:null;var c=function(a,b,c){a=d.createElement({tag:"li",inner:a,setAttributes:{"data-viewIndex":b}});d.addListener(a,"click",function(){return function(){c.call(c||
window,b)}}());b===0&&a.addClass("active");return a},e=function(a){h[p].removeClass("active");p=a;h[p].addClass("active");o.removeNode(true);o=q[a];g.appendChild(o)},f,i,h=[],j,g,o,q=[],p=0;f=d.createElement({tag:"div",id:"ModalDialogue",customClass:"sidebar"});i=d.createElement({tag:"div",customClass:"navigation",appendTo:f});g=d.createElement({tag:"div",customClass:"views",appendTo:f});typeof b.title=="string"&&d.createElement({tag:"h1",inner:b.title,appendTo:i});j=d.createElement({tag:"ol",appendTo:i});
if(typeof b.buttons=="object"){i=d.createElement({tag:"div",customClass:"buttons",appendTo:g});l.prototype.createButtons(b.buttons,i)}if(b.views instanceof Array)b.views.forEach(function(b,f){if(a(b)){b.buttons&&delete b.buttons;b.customId="ModalView"+(f+1);b.customClass="view";q.push(new l(b));var g=c(b.navTitle||b.title,f,e,n);h.push(g);j.appendChild(g)}else throw d.error("Invalid MDD - "+f);});else throw d.error("The MutiView Definition does not have any views.");o=q[0];g.appendChild(o);this.open(f,
b.animate&&b.animate.in);return f},close:function(){if(e&&m){new g(b,"fadeOut",0.5);new g(c,m,0.5,function(){c.removeNode(true);b.removeClass("visible")})}else{c.removeNode(true);b.removeClass("visible")}},open:function(a){b.removeChildren();c=a;if(k){b.appendChild(a);b.addClass("visible");new g(b,"fadeIn",0.5);new g(a,k,0.5)}else{b.appendChild(a);b.addClass("visible")}}};window.ModalDialogue=n})})();
